# RNA-Seq_Tutorial
STAR | HTSeq | DESeq2 workflow for transcriptomics tutorial for Data Science and Bioinformatics (UEA, BIO7051B)

## For Data Science and Bioinformatics students (BIO-7051B)

### Prior to Session5

- Try to run the /FastQProcessing/Pipeline (*Steps 1-5 in listed below*) including setting up the conda environment as described in the FastQ-to-ReadCounts_Pipeline.sh.

### During Session5
- If you haven't had a chance to do that, **no worries,**. I've provided the .tsv read-count files that you would have generated (see RNA-Seq_Tutorial/ReadCounts/README.md). *Skip to Steps 6-7*.

## Origin
This tutorial is modified from select subdirectories of the public repository [MaleLimitedEvo](https://github.com/mchlleliu/MaleLimitedEvo), which accompanies the publication Grieshop et al. (2025) in *Molecular Biology and Evolution (MBE)*. It contains scripts and pipelines for processing RNA-Seq data, including extracting gene lists, downloading reference genomes, renaming files, and generating read-count TSV files for downstream analysis using DESeq2 in R.

## Background
In six replicate populations of 1000 flies, a dominant marker (DsRed) on Chromosome 2 was used to force a “Red” pool of genetically variable chromosomes through exclusive father-to-son inheritance, while a complimentary pool of “NonRed” chromosomes was inherited primarily from mothers to daughters. After 100 generations, males carrying a Red chromosome copy exhibited greater mating success than males with only NonRed chromosomes, consistent with the accumulation of male-benefit/female-detriment sexually antagonistic alleles in the Red pool relative to NonRed. We analysed differentially expressed genes between flies with and without Red chromosomes.

## Tutorial overview
This directory contains materials for Session5 of the Data Science and Bioinformatics (BIO-7051B). The focus of this session is to:
- **Steps 1-5 below** are to be done prior to Session5 (but not essential). They document how RNA-Seq FastQ files were processed to read-count TSV files.
- **Steps 6-7 below** are for during Session5 (the essential tutorial). It demonstrates how to analyse read counts using DESeq2 in R (and let you explore that further).

## A recommended workflow
- Fork the repo to your own GitHub account,
- Clone your forked copy of the repo locally, 
- If jumping into **Step 6:** 
  - `scp` the TSV files from the HPC to your local workspace (see RNA-Seq_Tutorial/ReadCounts/).
- If starting from **Step 1:**
  - Open the crucial elements of cloned repo and modify them to run from your own HPC account,
  - Push the changes to GitHub (see [Bioinformatics_Onboarding/GitHub_tutorial](https://github.com/karlgrieshop/Bioinformatics_Onboarding/tree/main/GitHub_tutorial)),
    - Quick reminder: `git add --all` then `git commit -m 'a note'` then `git push origin main` 
  - Then log onto the HPC and navigate to your scratch directory
  - Clone the updated copy of your repo to your HPC ~/scratch/ directory,
    - Quick reminder: `git clone <SSH link>`
  - And for changes after cloning, use:
    - `git pull --rebase origin main`
  - This basically uses GitHub to mirror your local and HPC workspaces, backing up your progress along the way. 

## Contents

### 1. `FastQProcessing/Pipeline/`
- **Scripts**:  
  - `FastQ-to-ReadCounts_Pipeline.sh` (**optional, automated SLURM batch script**)
- **Purpose**: Processes paired-end RNA-Seq data from FastQ files into read-count TSV files. This includes genome indexing, read alignment, BAM file processing, and read counting.
- **Execution**:  
  - The `.sh` script provides a **fully automated alternative** for running the entire pipeline as a single SLURM batch job on an HPC.
- **Dependency**: Requires the reference genome and annotation files generated by the `FastQProcessing/GetReference/Get_Reference_Genome.sh` script.
- **Output**: Read-count TSV files for each sample.
- **Notes**: See `FastQProcessing/fastqFileRenaming/` for file renaming scripts.

### 2. `FastQProcessing/ExtractGenes/`
- **Script**: `Extract_Genes.sh`
- **Purpose**: Extracts gene lists for specific chromosomes (e.g., X, Y, autosomes, mitochondrial genome) from a GTF file, used for filtering and characterization in DESeq2 analysis.
- **Execution**: Runs on an HPC using SLURM.
- **Output**: Chromosome-specific gene lists in TSV format.

### 3. `FastQProcessing/GetReference/`
- **Script**: `Get_Reference_Genome.sh`
- **Purpose**: Downloads and prepares the Drosophila melanogaster reference genome and annotation files. It also generates indices for BWA, samtools, and STAR.
- **Execution**: Runs on an HPC using SLURM.
- **Output**: Reference genome files, GTF annotation file, and genome indices.

### 4. `FastQProcessing/tsvFileRenaming/`
- **Script**: `renameTSVfiles.sh`
- **Purpose**: Renames TSV files based on their sample name components for easier sorting and analysis in R.
- **Execution**: Runs on an HPC using SLURM.
- **Output**: Renamed TSV files.

### 5. `FastQProcessing/fastqFileRenaming/`
- **Script**: `renameFASTQfiles.sh`
- **Purpose**: Renames FastQ files based on a predefined mapping for consistency and clarity.
- **Execution**: Does not require SLURM; can be run locally or on a server or an HPC.
- **Output**: Renamed FastQ files.

### 6. `DESeq2/`
- **Script**: `DESeq2_tutorial.R`
- **Purpose**: Contains the DESeq2 tutorial script for differential gene expression analysis.
- **Execution**: DESeq2 in R, using the data in `ReadCounts/` prepared using the `Pipeline/` scripts.
- **Output**: Results of differential gene expression analysis.
- **Notes**: You will run DESeq2 locally in R Studio, so you will need to copy the .tsv files somewhere locally and import them into R.

### 7. `ReadCounts/`
- **Purpose**: Contains the read count files generated from `Pipeline/` for the analysis documented in `DESeq2/DESeq2_tutorial.R`.
- **Notes**: See `tsvFileRenaming/`.

## Software Requirements (for Steps 1-5)
- **STAR**: v2.7.9a or later
- **GATK**: v4.2.3.0-1 or later
- **HTSeq**: v0.13.5 or later
- **SLURM**: Required for job scheduling on an HPC
- **rename**: Required for renaming files in `renameFASTQfiles.sh`

## Reference Genome and Annotation
- **Reference Genome**: Drosophila melanogaster BDGP6.28, release 102
- **Annotation File**: GTF file from the same release

## Notes
- Some scripts are designed to run on an HPC using SLURM. Modify the SLURM directives as needed for your system.

## Contact
For questions or issues, contact [Karl Grieshop](https://github.com/karlgrieshop).
